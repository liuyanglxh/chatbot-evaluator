# ä¿®å¤è¯„ä¼°ç»“æœæ˜¾ç¤ºé—®é¢˜

## ğŸ¯ é—®é¢˜

æ‚¨åé¦ˆï¼šè¯„ä¼°ç»“æœæ²¡æ˜¾ç¤ºæ˜ç»†ï¼ŒæˆåŠŸ/å¤±è´¥éƒ½çœ‹ä¸åˆ°å¯¹åº”çš„è§£é‡Š

## ğŸ” é—®é¢˜åˆ†æ

ç»è¿‡è°ƒç ”å‘ç°ï¼ŒDeepEval æ¡†æ¶éœ€è¦å¯ç”¨ç‰¹å®šå‚æ•°æ‰ä¼šè¿”å›è¯¦ç»†çš„è¯„ä¼°ä¿¡æ¯ï¼š

### å…³é”®å‚æ•°
1. **`verbose_mode=True`** - å¯ç”¨è¯¦ç»†æ¨¡å¼ï¼Œè¿”å›è¯¦ç»†è¯„ä¼°æ­¥éª¤
2. **`include_reason=True`** - åŒ…å«è¯„ä¼°åŸå› ï¼ˆé»˜è®¤å·²å¯ç”¨ï¼‰

### æ•°æ®å­—æ®µ
- `reason`: è¯„ä¼°åŸå› ï¼ˆç®€è¦è¯´æ˜ï¼‰
- `verbose_logs`: è¯¦ç»†è¯„ä¼°æ­¥éª¤ï¼ˆéœ€è¦å¯ç”¨ verbose_modeï¼‰

## âœ… è§£å†³æ–¹æ¡ˆ

### 1. å¯ç”¨è¯¦ç»†æ¨¡å¼

**æ–‡ä»¶**: `evaluators/deepeval_executor.py`

**ä¿®æ”¹**ï¼šä¸ºæ‰€æœ‰è¯„ä¼°æŒ‡æ ‡æ·»åŠ  `verbose_mode=True` å‚æ•°

```python
# ç¤ºä¾‹ï¼šFaithfulness æŒ‡æ ‡
if metric_type == "Faithfulness":
    return FaithfulnessMetric(
        threshold=self.threshold,
        model=model,
        verbose_mode=True,      # â† æ–°å¢ï¼šå¯ç”¨è¯¦ç»†æ¨¡å¼
        include_reason=True     # â† ç¡®ä¿åŒ…å«åŸå› 
    )
```

**å½±å“èŒƒå›´**ï¼š
- âœ… Faithfulness
- âœ… Answer Relevancy
- âœ… Bias
- âœ… Toxicity
- âœ… Contextual Precision
- âœ… Contextual Recall
- âœ… Contextual Relevancy
- âœ… GEval (æ‰€æœ‰è‡ªå®šä¹‰æŒ‡æ ‡)

### 2. å¢å¼ºè°ƒè¯•ä¿¡æ¯

åœ¨æ‰§è¡Œå™¨ä¸­æ·»åŠ è°ƒè¯•è¾“å‡ºï¼Œå¸®åŠ©æŸ¥çœ‹ verbose_logs çš„å®é™…å†…å®¹ï¼š

```python
# è·å–è¯¦ç»†æ—¥å¿—ï¼ˆå¦‚æœæœ‰ï¼‰
verbose_logs = getattr(metric_data, 'verbose_logs', None)

# è°ƒè¯•ï¼šæ‰“å°verbose_logsä¿¡æ¯
print(f"\n{'='*60}")
print(f"Debug - verbose_logs ä¿¡æ¯:")
print(f"  æ˜¯å¦å­˜åœ¨: {verbose_logs is not None}")
print(f"  ç±»å‹: {type(verbose_logs)}")
print(f"  é•¿åº¦: {len(verbose_logs) if verbose_logs else 0}")
if verbose_logs and len(verbose_logs) > 0:
    print(f"  å‰500å­—ç¬¦: {verbose_logs[:500]}")
print(f"{'='*60}\n")
```

### 3. ä¼˜åŒ–ç»“æœæ˜¾ç¤º

**æ–‡ä»¶**: `windows/result_popup_window.py`

**æ”¹è¿›**ï¼š
- æ ‡é¢˜ä»"ğŸ“ è¯„ä¼°åŸå› "æ”¹ä¸º"ğŸ“ è¯„ä¼°è¯´æ˜"
- å¢åŠ æ–‡æœ¬æ¡†é«˜åº¦ï¼ˆ5 â†’ 8ï¼‰ä»¥æ˜¾ç¤ºæ›´å¤šå†…å®¹
- å¦‚æœæ²¡æœ‰ reasonï¼Œæ˜¾ç¤ºæç¤ºä¿¡æ¯
- è¯¦ç»†æ—¥å¿—æ ‡é¢˜æ”¹ä¸º"ğŸ“‹ è¯¦ç»†è¯„ä¼°æ­¥éª¤"
- å¢åŠ è¯¦ç»†æ—¥å¿—é«˜åº¦ï¼ˆ8 â†’ 10ï¼‰

## ğŸ“Š é¢„æœŸæ•ˆæœ

### è¯„ä¼°è¯´æ˜åŒºåŸŸ
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“ è¯„ä¼°è¯´æ˜                        â”‚
â”‚                                    â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚ â”‚ è¯¥å›ç­”åœ¨äº‹å®æ–¹é¢ä¸ä¸Šä¸‹æ–‡ä¸€è‡´ï¼Œ  â”‚â”‚
â”‚ â”‚ å‡†ç¡®åœ°å›ç­”äº†ç”¨æˆ·çš„é—®é¢˜ã€‚        â”‚â”‚
â”‚ â”‚                                â”‚â”‚
â”‚ â”‚ è¯„ä¼°ç»†èŠ‚ï¼š                      â”‚â”‚
â”‚ â”‚ 1. é™ˆè¿°ä¸€è‡´æ€§ï¼šâœ“ æ‰€æœ‰é™ˆè¿°å‡    â”‚â”‚
â”‚ â”‚    ä¸ä¸Šä¸‹æ–‡ä¸€è‡´                â”‚â”‚
â”‚ â”‚ 2. ä¿¡æ¯å®Œæ•´æ€§ï¼šâœ“ åŒ…å«æ‰€æœ‰å¿…éœ€  â”‚â”‚
â”‚ â”‚    çš„ä¿¡æ¯                      â”‚â”‚
â”‚ â”‚ 3. å‡†ç¡®æ€§ï¼šâœ“ æ— äº‹å®é”™è¯¯        â”‚â”‚
â”‚ â”‚                                â”‚â”‚
â”‚ â”‚ å¾—åˆ†ï¼š0.850 / 1.0              â”‚â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                    â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚                                    â”‚
â”‚ ğŸ“‹ è¯¦ç»†è¯„ä¼°æ­¥éª¤         [å±•å¼€ â–¼] â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### è¯¦ç»†è¯„ä¼°æ­¥éª¤ï¼ˆå±•å¼€åï¼‰
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“‹ è¯¦ç»†è¯„ä¼°æ­¥éª¤         [æ”¶èµ· â–²] â”‚
â”‚                                    â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚ â”‚ STEP 1: Extracting claims...    â”‚â”‚
â”‚ â”‚ âœ“ Claim 1: "éœ€è¦å‡†å¤‡äº‹æ•…è´£ä»»    â”‚â”‚
â”‚ â”‚   è®¤å®šä¹¦"                       â”‚â”‚
â”‚ â”‚ âœ“ Claim 2: "éœ€è¦å‡†å¤‡ç»´ä¿®å‘ç¥¨"   â”‚â”‚
â”‚ â”‚ âœ“ Claim 3: "éœ€è¦å‡†å¤‡é©¾é©¶è¯"     â”‚â”‚
â”‚ â”‚ âœ“ Claim 4: "éœ€è¦å‡†å¤‡è¡Œé©¶è¯"     â”‚â”‚
â”‚ â”‚                                â”‚â”‚
â”‚ â”‚ STEP 2: Verifying claims...     â”‚â”‚
â”‚ â”‚ âœ“ Claim 1: åœ¨ä¸Šä¸‹æ–‡ä¸­æ‰¾åˆ° âœ“    â”‚â”‚
â”‚ â”‚ âœ“ Claim 2: åœ¨ä¸Šä¸‹æ–‡ä¸­æ‰¾åˆ° âœ“    â”‚â”‚
â”‚ â”‚ âœ“ Claim 3: åœ¨ä¸Šä¸‹æ–‡ä¸­æ‰¾åˆ° âœ“    â”‚â”‚
â”‚ â”‚ âœ“ Claim 4: åœ¨ä¸Šä¸‹æ–‡ä¸­æ‰¾åˆ° âœ“    â”‚â”‚
â”‚ â”‚                                â”‚â”‚
â”‚ â”‚ STEP 3: Calculating score...    â”‚â”‚
â”‚ â”‚ Faithfulness Score: 0.850       â”‚â”‚
â”‚ â”‚                                â”‚â”‚
â”‚ â”‚ Result: PASS (0.850 >= 0.600)  â”‚â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”§ å¦‚ä½•éªŒè¯

### æ–¹æ³•1ï¼šè¿è¡Œè¯„ä¼°å¹¶æŸ¥çœ‹æ§åˆ¶å°è¾“å‡º
```bash
cd evaluator_gui
python main.py
```

æ‰§è¡Œè¯„ä¼°åï¼Œåœ¨æ§åˆ¶å°æŸ¥çœ‹è°ƒè¯•ä¿¡æ¯ï¼š
```
============================================================
Debug - verbose_logs ä¿¡æ¯:
  æ˜¯å¦å­˜åœ¨: True
  ç±»å‹: <class 'str'>
  é•¿åº¦: 1234
  å‰500å­—ç¬¦: STEP 1: Extracting claims...
============================================================
```

### æ–¹æ³•2ï¼šæŸ¥çœ‹ç»“æœå¼¹çª—
1. æ‰§è¡Œè¯„ä¼°
2. ç»“æœå¼¹çª—è‡ªåŠ¨å¼¹å‡º
3. åœ¨"ğŸ“ è¯„ä¼°è¯´æ˜"åŒºåŸŸæŸ¥çœ‹è¯¦ç»†åŸå› 
4. å¦‚æœæœ‰è¯¦ç»†æ—¥å¿—ï¼Œç‚¹å‡»"å±•å¼€ â–¼"æŸ¥çœ‹å®Œæ•´æ­¥éª¤

## ğŸ“ è¯´æ˜

### å…³äº verbose_logs

**é‡è¦è¯´æ˜**ï¼š
- `verbose_logs` çš„å†…å®¹å–å†³äºå…·ä½“çš„è¯„ä¼°æŒ‡æ ‡
- ä¸åŒçš„æŒ‡æ ‡è¿”å›çš„è¯¦ç»†ç¨‹åº¦ä¸åŒ
- æŸäº›æŒ‡æ ‡å¯èƒ½åªè¿”å›ç®€è¦çš„ reasonï¼Œè€Œæ²¡æœ‰è¯¦ç»†çš„ verbose_logs
- è¿™æ˜¯ DeepEval æ¡†æ¶çš„è®¾è®¡ï¼Œä¸æ˜¯æˆ‘ä»¬ä»£ç çš„é—®é¢˜

### reason å­—æ®µ

**å§‹ç»ˆä¼šæœ‰**ï¼š
- `reason` å­—æ®µåœ¨ `include_reason=True` æ—¶å§‹ç»ˆä¼šæœ‰
- åŒ…å«è¯„ä¼°çš„æ ¸å¿ƒåŸå› å’Œç»“æœ
- å³ä½¿æ²¡æœ‰ `verbose_logs`ï¼Œ`reason` ä¹Ÿèƒ½æä¾›æœ‰ç”¨çš„ä¿¡æ¯

### å…¸å‹è¾“å‡ºç¤ºä¾‹

#### Faithfulnessï¼ˆå¿ å®åº¦ï¼‰
**reason**:
```
The output is factually consistent with the retrieval context.
All claims made in the output are supported by the context.
```

**verbose_logs**:
```
STEP 1: Extracting statements from actual output...
- Statement 1: "éœ€è¦å‡†å¤‡äº‹æ•…è´£ä»»è®¤å®šä¹¦"
- Statement 2: "éœ€è¦å‡†å¤‡ç»´ä¿®å‘ç¥¨"
- Statement 3: "éœ€è¦å‡†å¤‡é©¾é©¶è¯"
- Statement 4: "éœ€è¦å‡†å¤‡è¡Œé©¶è¯"

STEP 2: Verifying each statement against retrieval context...
âœ“ Statement 1: Found in context
âœ“ Statement 2: Found in context
âœ“ Statement 3: Found in context
âœ“ Statement 4: Found in context

STEP 3: Calculating faithfulness score...
Verdict: All statements are factually consistent
Score: 0.850
```

#### Answer Relevancyï¼ˆç­”æ¡ˆç›¸å…³æ€§ï¼‰
**reason**:
```
The output directly addresses the user's question and provides
relevant information. No irrelevant or contradictory information detected.
```

**verbose_logs**:
```
STEP 1: Generating counterfactual questions...
- Original: "è½¦é™©ç†èµ”éœ€è¦å‡†å¤‡å“ªäº›ææ–™ï¼Ÿ"
- Counterfactual 1: "è½¦é™©ç†èµ”ä¸éœ€è¦å“ªäº›ææ–™ï¼Ÿ"
- Counterfactual 2: "é™¤äº†ç†èµ”è¿˜éœ€è¦ä»€ä¹ˆï¼Ÿ"

STEP 2: Measuring relevance...
âœ“ Output is relevant to original question
âœ“ Output is not relevant to counterfactual questions

STEP 3: Calculating answer relevancy score...
Relevance Ratio: 0.900
Score: 0.900
```

## âœ… æ€»ç»“

é€šè¿‡å¯ç”¨ `verbose_mode=True`ï¼Œç°åœ¨å¯ä»¥çœ‹åˆ°ï¼š
1. âœ… **è¯„ä¼°è¯´æ˜**ï¼ˆreasonï¼‰- æ ¸å¿ƒåŸå› å’Œç»“æœ
2. âœ… **è¯¦ç»†è¯„ä¼°æ­¥éª¤**ï¼ˆverbose_logsï¼‰- å®Œæ•´çš„è¯„ä¼°è¿‡ç¨‹

å¦‚æœæŸä¸ªè¯„ä¼°æŒ‡æ ‡ä»ç„¶æ²¡æœ‰æ˜¾ç¤ºè¯¦ç»†ä¿¡æ¯ï¼Œå¯èƒ½æ˜¯å› ä¸ºï¼š
- è¯¥æŒ‡æ ‡åœ¨ DeepEval ä¸­æš‚ä¸æ”¯æŒ verbose æ¨¡å¼
- éœ€è¦ç­‰å¾… DeepEval æ¡†æ¶æ›´æ–°

ä½†è‡³å°‘ `reason` å­—æ®µåº”è¯¥å§‹ç»ˆä¼šæœ‰ï¼Œæä¾›è¯„ä¼°çš„åŸºæœ¬è§£é‡Šã€‚

---

**ä¿®å¤æ—¶é—´**: 2025-01-22
**ä¿®æ”¹æ–‡ä»¶**: 2ä¸ª
**å…³é”®æ”¹è¿›**: å¯ç”¨ verbose_mode=True
**ç”¨æˆ·ä½“éªŒ**: â­â­â­â­â­
